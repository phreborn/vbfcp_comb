<!DOCTYPE Organization  SYSTEM 'Organization.dtd'>
<Organization InFile="workspace/hsg2/H4l_STXS_13TeV_decorated.root"
	     OutFile="workspace/hsg2/H4l_STXS_13TeV_with_theory_uncert.root"
	     ModelName="theory_uncert"
	     POINames="mu, mu_gg2H_total_ZZ, mu_VBF_total_ZZ, mu_WH_total_ZZ, mu_ZH_total_ZZ, mu_ttH_total_ZZ">
  <!-- Signal strength parameters. Floating global signal strength and fix others to SM. -->
  <Item Name="mu[1,0,5]"/>
  <Item Name="mu_gg2H_total_ZZ[1]"/>
  <Item Name="mu_VBF_total_ZZ[1]"/>
  <Item Name="mu_WH_total_ZZ[1]"/>
  <Item Name="mu_ZH_total_ZZ[1]"/>
  <Item Name="mu_ttH_total_ZZ[1]"/>
  
  <!-- SM XSBR values -->
  <Item Name="XS13_gg2H_total_ZZ_SM[1.27231]"/>
  <Item Name="XS13_VBF_total_ZZ_SM[0.0990506]"/>
  <Item Name="XS13_WH_total_ZZ_SM[0.0359589]"/>
  <Item Name="XS13_ZH_total_ZZ_SM[0.0231493]"/>
  <Item Name="XS13_ttH_total_ZZ_SM[0.0132809]"/>

  <!-- Construct NP and global observables -->
  <Item Name="QCDscale_ggH[0,-5,5]"/>
  <Item Name="QCDscale_ggH_In[0]"/>
  <Item Name="QCDscale_qqH[0,-5,5]"/>
  <Item Name="QCDscale_qqH_In[0]"/>
  <Item Name="QCDscale_VH[0,-5,5]"/>
  <Item Name="QCDscale_VH_In[0]"/>
  <Item Name="QCDscale_ttH[0,-5,5]"/>
  <Item Name="QCDscale_ttH_In[0]"/>
  
  <Item Name="BR_param_alphaS_ZZ[0,-5,5]"/>
  <Item Name="BR_param_alphaS_ZZ_In[0]"/>
  <Item Name="BR_param_mQ_ZZ[0,-5,5]"/>
  <Item Name="BR_param_mQ_ZZ_In[0]"/>
  <Item Name="BR_HiggsDecayWidthTHU_ZZ[0,-5,5]"/>
  <Item Name="BR_HiggsDecayWidthTHU_ZZ_In[0]"/>
  
  <Item Name="pdf_Higgs_ggH[0,-5,5]"/>
  <Item Name="pdf_Higgs_ggH_In[0]"/>
  <Item Name="pdf_Higgs_qqH[0,-5,5]"/>
  <Item Name="pdf_Higgs_qqH_In[0]"/>
  <Item Name="pdf_Higgs_VH[0,-5,5]"/>
  <Item Name="pdf_Higgs_VH_In[0]"/>
  <Item Name="pdf_Higgs_ttH[0,-5,5]"/>
  <Item Name="pdf_Higgs_ttH_In[0]"/>

  <!-- Construnct constraint p.d.f. -->
  <!-- It is EXTREMELY IMPORTANT to include "ConstraintPdf" in the constraint pdf name, such that the code can identify it -->
  <Item Name="RooGaussian::ConstraintPdf_QCDscale_ggH(QCDscale_ggH, QCDscale_ggH_In, 1)"/>
  <Item Name="RooGaussian::ConstraintPdf_QCDscale_qqH(QCDscale_qqH, QCDscale_qqH_In, 1)"/>
  <Item Name="RooGaussian::ConstraintPdf_QCDscale_VH(QCDscale_VH, QCDscale_VH_In, 1)"/>
  <Item Name="RooGaussian::ConstraintPdf_QCDscale_ttH(QCDscale_ttH, QCDscale_ttH_In, 1)"/>
  
  <Item Name="RooGaussian::ConstraintPdf_BR_param_alphaS_ZZ(BR_param_alphaS_ZZ, BR_param_alphaS_ZZ_In, 1)"/>
  <Item Name="RooGaussian::ConstraintPdf_BR_param_mQ_ZZ(BR_param_mQ_ZZ, BR_param_mQ_ZZ_In, 1)"/>
  <Item Name="RooGaussian::ConstraintPdf_BR_HiggsDecayWidthTHU_ZZ(BR_HiggsDecayWidthTHU_ZZ, BR_HiggsDecayWidthTHU_ZZ_In, 1)"/>
  
  <Item Name="RooGaussian::ConstraintPdf_pdf_Higgs_ggH(pdf_Higgs_ggH, pdf_Higgs_ggH_In, 1)"/>
  <Item Name="RooGaussian::ConstraintPdf_pdf_Higgs_qqH(pdf_Higgs_qqH, pdf_Higgs_qqH_In, 1)"/>
  <Item Name="RooGaussian::ConstraintPdf_pdf_Higgs_VH(pdf_Higgs_VH, pdf_Higgs_VH_In, 1)"/>
  <Item Name="RooGaussian::ConstraintPdf_pdf_Higgs_ttH(pdf_Higgs_ttH, pdf_Higgs_ttH_In, 1)"/>

  <!-- Prepare response function -->
  <!-- Not sure how to consider the theory uncertainty correlation between signal and background. Leave it to experts to decide -->
  
  <!-- QCD scale uncertainties -->
  <!-- Format: function_name(NP_name,central_value,errHi,errLo,interpolation_code) -->
  <!-- N.B. the different convention with HistFactory: use uncertainty magnitude instead of variation boundary -->
  <Item Name="FlexibleInterpVar::response_QCDscale_gg2H(QCDscale_ggH,1,+0.046,-0.067,4)"/>
  <Item Name="FlexibleInterpVar::response_QCDscale_VBF(QCDscale_qqH,1,+0.004,-0.003,4)"/>
  <Item Name="FlexibleInterpVar::response_QCDscale_WH(QCDscale_VH,1,+0.005,-0.007,4)"/>
  <Item Name="FlexibleInterpVar::response_QCDscale_ZH(QCDscale_VH,1,+0.038,-0.031,4)"/>
  <Item Name="FlexibleInterpVar::response_QCDscale_ttH(QCDscale_ttH,1,+0.058,-0.092,4)"/>

  <!-- BR uncertainties -->
  <Item Name="FlexibleInterpVar::response_BR_param_alphaS_ZZ(BR_param_alphaS_ZZ,1,+0.0369,-0.0361,4)"/>
  <Item Name="FlexibleInterpVar::response_BR_param_mQ_ZZ(BR_param_mQ_ZZ,1,+0.0112,-0.0113,4)"/>
  <Item Name="FlexibleInterpVar::response_BR_HiggsDecayWidthTHU_ZZ(BR_HiggsDecayWidthTHU_ZZ,1,+0.0340,-0.0341,4)"/>
  
  <!-- PDF uncertainties: symmetrized. Use lognormal -->
  <!-- Not considering the correlation of alpha_S part with BR uncertainty here. Should be improved -->
  <Item Name="prod::response_pdf_gg2H(RooExponential::expTerm_pdf_gg2H(pdf_Higgs_ggH, expr::log_kappa_value_pdf_gg2H('log(1+@0)', uncert_pdf_gg2H[0.032])),nominal_pdf_gg2H[1])"/>
  <Item Name="prod::response_pdf_VBF(RooExponential::expTerm_pdf_VBF(pdf_Higgs_qqH, expr::log_kappa_value_pdf_VBF('log(1+@0)', uncert_pdf_VBF[0.021])),nominal_pdf_VBF[1])"/>
  <Item Name="prod::response_pdf_WH(RooExponential::expTerm_pdf_WH(pdf_Higgs_VH, expr::log_kappa_value_pdf_WH('log(1+@0)', uncert_pdf_WH[0.019])),nominal_pdf_WH[1])"/>
  <Item Name="prod::response_pdf_ZH(RooExponential::expTerm_pdf_ZH(pdf_Higgs_VH, expr::log_kappa_value_pdf_ZH('log(1+@0)', uncert_pdf_ZH[0.016])),nominal_pdf_ZH[1])"/>
  <Item Name="prod::response_pdf_ttH(RooExponential::expTerm_pdf_ttH(pdf_Higgs_ttH, expr::log_kappa_value_pdf_ttH('log(1+@0)', uncert_pdf_ttH[0.036])),nominal_pdf_ttH[1])"/>

  <!-- Finally prepare the replacement for current cross section handlers -->
  <Item Name="prod::XS13_gg2H_total_ZZ_with_uncert(mu, mu_gg2H_total_ZZ, XS13_gg2H_total_ZZ_SM, response_QCDscale_gg2H, response_pdf_gg2H, response_BR_param_alphaS_ZZ, response_BR_param_mQ_ZZ, response_BR_HiggsDecayWidthTHU_ZZ)"/>
  <Item Name="prod::XS13_VBF_total_ZZ_with_uncert(mu, mu_VBF_total_ZZ, XS13_VBF_total_ZZ_SM, response_QCDscale_VBF, response_pdf_VBF, response_BR_param_alphaS_ZZ, response_BR_param_mQ_ZZ, response_BR_HiggsDecayWidthTHU_ZZ)"/>
  <Item Name="prod::XS13_WH_total_ZZ_with_uncert(mu, mu_WH_total_ZZ, XS13_WH_total_ZZ_SM, response_QCDscale_WH, response_pdf_WH, response_BR_param_alphaS_ZZ, response_BR_param_mQ_ZZ, response_BR_HiggsDecayWidthTHU_ZZ)"/>
  <Item Name="prod::XS13_ZH_total_ZZ_with_uncert(mu, mu_ZH_total_ZZ, XS13_ZH_total_ZZ_SM, response_QCDscale_ZH, response_pdf_ZH, response_BR_param_alphaS_ZZ, response_BR_param_mQ_ZZ, response_BR_HiggsDecayWidthTHU_ZZ)"/>
  <Item Name="prod::XS13_ttH_total_ZZ_with_uncert(mu, mu_ttH_total_ZZ, XS13_ttH_total_ZZ_SM, response_QCDscale_ttH, response_pdf_ttH, response_BR_param_alphaS_ZZ, response_BR_param_mQ_ZZ, response_BR_HiggsDecayWidthTHU_ZZ)"/>


  <!-- PDF -->
  <Item Name="EDIT::NEWPDF(OLDPDF,
	      XS13_gg2H_total_ZZ=XS13_gg2H_total_ZZ_with_uncert,
	      XS13_VBF_total_ZZ=XS13_VBF_total_ZZ_with_uncert,
	      XS13_WH_total_ZZ=XS13_WH_total_ZZ_with_uncert,
	      XS13_ZH_total_ZZ=XS13_ZH_total_ZZ_with_uncert,
	      XS13_ttH_total_ZZ=XS13_ttH_total_ZZ_with_uncert,
	      )"/>
</Organization>
